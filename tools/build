#!/usr/bin/env python

# This script facilitates various repo-wild builds.
#
# At the moment it just autogenerates notebooks

import sys, os, os.path
from pathlib import Path

os.chdir('dev_nb')
path = Path('.')
sys.path.append(str(path))
import notebook2script

for file in path.glob('0*ipynb'):
    fname = str(file)
    fname_out = notebook2script.get_py_fname(fname)

    # skip unmodified notebooks
    in_mod  = os.path.getmtime(fname)
    out_mod = os.path.getmtime(fname_out)
    if in_mod < out_mod: continue

    # autogenerated notebooks have #export in them
    if '#export' in file.read_text():
        # print(f"Autogenerating {file}")
        notebook2script.notebook2script(file)

print('All is up-to-date')
